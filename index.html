<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3table</title>
    <link rel="stylesheet" href="./styles/main.css">
    <link rel="stylesheet" href="./styles/table.css">
    <link rel="stylesheet" href="./styles/slider.css">
    <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
    <script async type="importmap">
      {
        "imports": {
          "three": "./lib/three.module.js",
          "orbitControls": "./lib/OrbitControls.js",
          "STLLoader": "./lib/STLLoader.js",
          "STLExporter": "./lib/STLExporter.js",
          "parts": "./parts.js",
          "model": "./model.js",
          "3DTable": "./3DTable.js",
          "CSVTextArea": "./CSVTextArea.js",
          "gui": "./gui.js",
          "app": "./app.js"
        }
      }
    </script>    
    <script async type="text/javascript" src="./lib/dat.gui.min.js"></script>
    <script async type="module" src="./app.js"></script>
    <script async type="module" src="./gui.js"></script>
  </head>
  <body>
    <div class="warning">
      WARNING: EXPERIMENTAL!
    </div>
    <div class="loader">
      Loading...
    </div>
    <div class="gui-container">
      <div class="app-buttons">
        <button id="helpButton" class="ui-btn">?</button>
        <select name="models" id="model-select">
          <option value="cube.csv">Cube</option>
          <option value="cubes.csv">Cubes</option>
          <option value="rounded.csv">Rounded cube</option>
          <option value="profile_cube.csv">Profile Cube</option>          
          <option value="blocks.csv">Blocks</option>
          <option value="rig.csv">Sim Rig</option>
        </select>
        <button id="expButton" class="ui-btn">File</button>  
        <button id="listButton" class="ui-btn">BOM</button>
        <button id="csvButton" class="ui-btn">CSV</button>
      </div>
      <table class="spec-table">
        <thead>
          <tr class="top-thead">
            <th></th>
            <th></th>
            <th colspan="3">Scale</th>
            <th colspan="3">Position</th>
            <th colspan="3">Rotation</th>
          </tr>
          <tr class="bottom-thead">
            <th>Part</th>
            <th>Parent</th>
            <th>X</th>
            <th>Y</th>
            <th>Z</th>
            <th>X</th>
            <th>Y</th>
            <th>Z</th>
            <th>X</th>
            <th>Y</th>
            <th>Z</th>
          </tr>
        </thead>
        <tbody class="spec-table-body"></tbody>
      </table>
      <div class="table-controls">
        <button id="addButton" class="img-btn">
          <img src="../add.svg" alt="Add part">
        </button>
        <button id="deleteButton" class="img-btn">
          <img src="../delete.svg" alt="Delete part">
        </button>
        <button id="copyButton" class="img-btn">
          <img src="../copy.svg" alt="Copy part">
        </button>
        <!--    
        <button id="upButton" class="img-btn">
          <img src="../up.svg" alt="Move part up">
        </button>
        <button id="downButton" class="img-btn">
          <img src="../down.svg" alt="Move part down">
        </button>
        <button id="undoButton" class="img-btn">
          <img src="../undo.svg" alt="Undo">
        </button>
        <button id="redoButton" class="img-btn">
          <img src="../redo.svg" alt="Redo"> 
        </button>  
        <button id="snapButton" class="img-btn">
          <img src="../snap.svg" alt="Snap"> 
        </button>  
        -->
      </div>
      <input class="val-slider" type="range" value="0" min="-1000" max="1000" disabled/>
      <textarea wrap="off" id="ta" rows="10" cols="50">Loading...</textarea>
    </div>
       
    <dialog id="helpDialog">
      <h3>How to design your 3D model</h3>
      <p>Each row represents a model part as follows:</p>
      <p>Name, Parent, x, y, z (scale), x, y, z (position), x, y, z (angle)</p>
      <p>Currently available parts are:
        <ul id="partsUl">Loading...</ul>
      </p>
      <p>
        Parents are an assembly of parts that can also be used as a part.<br/>
        Every part must have a parent assembly. The top level or default assembly can be called anything e.g. "model".<br/>
      </p> 
      <p>3Table is particularly suited to aluminium profile construction design so some profile parts have been included.</p>
      <p>Extruded parts are set to 100mm depth by default. Scale the z axis to get the desired length.</p>
      <p>The model can be edited in the table by clicking the cell or by changing the CSV (Comma Separated Values) text.</p>
      <p>If editing the CSV text use a '#' at the start of the line to hide a part.</p>  
      <form method="dialog">
        <button class="ui-btn green">Close</button>
      </form>
    </dialog>
  
    <dialog id="plDialog">
      <h3>Bill Of Material</h3>
      <p id="plText"></p>
      <form method="dialog">
        <button class="ui-btn blue">Close</button>
        <button class="ui-btn green" onclick="dlParts()">Save</button>
      </form>
    </dialog>

    <dialog id="exportDialog">
      <h3>Import</h3>
      <div class="vButtons">
        <button class="ui-btn blue" id="importButton">CSV File</button>
        <input type="file" id="input-file" accept=".csv" hidden>
      </div>
      <h3>Export</h3>
      <div class="vButtons">
        <button class="ui-btn blue" onclick="dlCSV()">CSV File</button>
        <button class="ui-btn blue" onclick="dlParts()">BOM (txt)</button>
        <button class="ui-btn blue" onclick="dlSTL()">3D Model (STL)</button>
      </div>
      <form class="close" method="dialog">
        <button class="ui-btn green">Close</button>
      </form>
    </dialog>
  
    <dialog id="addDialog">
      <h3>Add Part</h3>
      <p>
        Select a part<br/>
        <select name="partSelect" id="part-select"></select>
      </p>
      <p>
        Set the parent<br/>
        <select name="parentSelect" id="parent-select"></select>
      </p>
      <form class="close" method="dialog">
        <button id="addDialogButton" class="ui-btn green">Add</button>
        <button class="ui-btn blue">Cancel</button>
      </form>
    </dialog>
  
    <div id="guiContainer"></div>
  </body>
</html>